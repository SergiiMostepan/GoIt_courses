{"version":3,"sources":["webpack:///./templates/message.hbs","webpack:///./js-components/app.js","webpack:///./js-components/localStorage.js"],"names":["Handlebars","module","exports","template","container","depth0","helpers","partials","data","helper","alias1","nullContext","alias2","hooks","helperMissing","alias3","alias4","escapeExpression","className","call","image","name","message","currentDate","myFile","map","load","key","serializedState","localStorage","getItem","undefined","JSON","parse","err","console","error","save","value","stringify","setItem","refs","massege","document","querySelector","form","asyncMap","file","userNameForm","chatSection","registrationSection","changeDataButton","avatarImg","userName","uluru","pad","String","padStart","navigator","geolocation","getCurrentPosition","position","lat","coords","latitude","lng","longitude","src","type","onload","google","maps","Map","getElementById","zoom","center","ws","WebSocket","onmessage","date","Date","getHours","getMinutes","getSeconds","cords","markup","messageTemplate","insertAdjacentHTML","Marker","addEventListener","e","target","files","FR","FileReader","readAsDataURL","result","inputName","preventDefault","elements","alert","removeItem","local","localStorageLoader","saveToLocal","classList","add","toggle","inputField","send","window","body","children","registration"],"mappings":"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","file":"main.c99ea7c71ec30ef9a925.js","sourcesContent":["var Handlebars = require(\"../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[8,\">= 4.3.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var helper, alias1=depth0 != null ? depth0 : (container.nullContext || {}), alias2=container.hooks.helperMissing, alias3=\"function\", alias4=container.escapeExpression;\n\n  return \"<li class=\\\"message \"\n    + alias4(((helper = (helper = helpers.className || (depth0 != null ? depth0.className : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"className\",\"hash\":{},\"data\":data,\"loc\":{\"start\":{\"line\":1,\"column\":19},\"end\":{\"line\":1,\"column\":32}}}) : helper)))\n    + \"\\\">\\r\\n    <img class=\\\"image\\\" src=\\\"\"\n    + alias4(((helper = (helper = helpers.image || (depth0 != null ? depth0.image : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"image\",\"hash\":{},\"data\":data,\"loc\":{\"start\":{\"line\":2,\"column\":28},\"end\":{\"line\":2,\"column\":37}}}) : helper)))\n    + \"\\\">\\r\\n    <div class=\\\"message-body\\\">\\r\\n        <span class=\\\"user-name\\\">\"\n    + alias4(((helper = (helper = helpers.name || (depth0 != null ? depth0.name : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"name\",\"hash\":{},\"data\":data,\"loc\":{\"start\":{\"line\":4,\"column\":32},\"end\":{\"line\":4,\"column\":40}}}) : helper)))\n    + \"</span>\\r\\n        <div class=\\\"mesage-content\\\">\\r\\n            <div class=\\\"message-text\\\">\"\n    + alias4(((helper = (helper = helpers.message || (depth0 != null ? depth0.message : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"message\",\"hash\":{},\"data\":data,\"loc\":{\"start\":{\"line\":6,\"column\":38},\"end\":{\"line\":6,\"column\":49}}}) : helper)))\n    + \"</div>\\r\\n            <div class=\\\"message-time\\\">\"\n    + alias4(((helper = (helper = helpers.currentDate || (depth0 != null ? depth0.currentDate : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"currentDate\",\"hash\":{},\"data\":data,\"loc\":{\"start\":{\"line\":7,\"column\":38},\"end\":{\"line\":7,\"column\":53}}}) : helper)))\n    + \"</div>\\r\\n        </div>\\r\\n    </div>\\r\\n</li>\";\n},\"useData\":true});","import messageTemplate from '../templates/message.hbs';\r\nimport localStorageLoader from './localStorage.js'\r\n\r\nconst refs = {\r\n  massege: document.querySelector('#chat'),\r\n  form: document.querySelector('#inputForm'),\r\n  asyncMap: document.querySelector('[data-name=\"async\"]'),\r\n  file: document.querySelector('#file'),\r\n  userNameForm: document.querySelector('#userNameForm'),\r\n  chatSection: document.querySelector('.chatSection'),\r\n  registrationSection: document.querySelector('.registration'),\r\n  changeDataButton: document.querySelector('#changeData'),\r\n  avatarImg: document.querySelector('#avatarImg'),\r\n};\r\n\r\nlet userName = '';\r\nlet myFile;\r\nlet map;\r\nlet uluru = {};\r\nlet className;\r\n\r\n// получаем текущую геолокацию\r\nnavigator.geolocation.getCurrentPosition(position => {\r\n  uluru.lat = position.coords.latitude;\r\n  uluru.lng = position.coords.longitude;\r\n});\r\n\r\n// создаем карту\r\n(function googleMap() {\r\n  refs.asyncMap.src =\r\n    'https://maps.googleapis.com/maps/api/js?key=AIzaSyB7Zkwv8ZHein66BAALTpWsJAQorKjiTlw';\r\n  refs.asyncMap.type = 'text/javascript';\r\n  refs.asyncMap.onload = () => {\r\n    map = new google.maps.Map(document.getElementById('map'), {\r\n      zoom: 10,\r\n      center: uluru,\r\n    });\r\n  };\r\n})();\r\n\r\n// берем текущее время\r\nfunction getDate() {\r\n  let date = new Date();\r\n  let h = pad(date.getHours());\r\n  let m = pad(date.getMinutes());\r\n  let s = pad(date.getSeconds());\r\n  return `${h}:${m}:${s}`;\r\n}\r\n\r\nfunction pad(value) {\r\n  return String(value).padStart(2, '0');\r\n}\r\n\r\n// создаем соединение\r\nlet ws = new WebSocket('wss://venify.herokuapp.com/chat');\r\n\r\n// выводим инфу с сервака\r\nws.onmessage = ({\r\n  data\r\n}) => {\r\n  let currentDate = getDate();\r\n  const {\r\n    cords,\r\n    message,\r\n    name,\r\n    image\r\n  } = JSON.parse(data);\r\n  if (name === userName) {\r\n    className = 'myUser';\r\n  } else {\r\n    className = 'anotherUser';\r\n  }\r\n  let markup = messageTemplate({\r\n    message,\r\n    name,\r\n    image,\r\n    currentDate,\r\n    className,\r\n  });\r\n  refs.massege.insertAdjacentHTML('beforeend', markup);\r\n  const marker = new google.maps.Marker({\r\n    position: cords,\r\n    map: map,\r\n  });\r\n};\r\n\r\n\r\nrefs.file.addEventListener('change', e => {\r\n  const file = e.target.files[0];\r\n  const FR = new FileReader();\r\n  FR.readAsDataURL(file);\r\n  FR.addEventListener('load', function (e) {\r\n    myFile = e.target.result;\r\n    avatarImg.src = myFile;\r\n  });\r\n});\r\n\r\n// отправляем данные на сервер\r\nconst sendData = message => {\r\n  ws.send(\r\n    JSON.stringify({\r\n      cords: uluru,\r\n      message: message,\r\n      name: userName,\r\n      image: myFile,\r\n    }),\r\n  );\r\n};\r\n\r\n\r\n\r\n// вводим имя\r\nfunction newName(inputName) {\r\n  userName = inputName;\r\n  if (myFile === undefined) {\r\n    myFile = 'https://image.flaticon.com/icons/png/512/18/18436.png'\r\n  }\r\n}\r\n\r\n\r\nfunction saveToLocal() {\r\n  localStorage.removeItem('local')\r\n  let local = {\r\n    name: userName,\r\n    image: myFile\r\n  }\r\n  localStorageLoader.save('local', local)\r\n}\r\n\r\nfunction visibleChat() {\r\n  refs.chatSection.classList.add('visible');\r\n  refs.registrationSection.classList.add('invisible');\r\n}\r\n\r\nfunction changeData() {\r\n  refs.registrationSection.classList.toggle('invisible');\r\n  refs.chatSection.classList.toggle('visible');\r\n}\r\n\r\nrefs.userNameForm.addEventListener('submit', e => {\r\n  e.preventDefault();\r\n  if (e.target.elements.userName.value === '') {\r\n    alert('Введите имя')\r\n  } else {\r\n    newName(e.target.elements.userName.value);\r\n    saveToLocal()\r\n    visibleChat();\r\n  }\r\n});\r\n\r\nrefs.changeDataButton.addEventListener('click', e => {\r\n  e.preventDefault();\r\n  changeData();\r\n});\r\n\r\nrefs.form.addEventListener('submit', e => {\r\n  e.preventDefault();\r\n  sendData(e.target.elements.inputField.value);\r\n  e.target.elements.inputField.value = '';\r\n});\r\n\r\n\r\nwindow.addEventListener('DOMContentLoaded', e => {\r\n  const {\r\n    name,\r\n    image\r\n  } = localStorageLoader.load('local');\r\n  if (name !== undefined) {\r\n    e.target.body.children.registration.children.userNameForm.elements.userName.value = name;\r\n  }\r\n  if (image !== undefined) {\r\n    avatarImg.src = image\r\n    myFile = image\r\n  }\r\n  // console.dir(e.target.body.children.registration.children.userNameForm.elements)\r\n});\r\n","const load = key => {\r\n  try {\r\n    const serializedState = localStorage.getItem(key);\r\n\r\n    return serializedState === null ? undefined : JSON.parse(serializedState);\r\n  } catch (err) {\r\n    console.error('Get state error: ', err);\r\n  }\r\n};\r\n\r\n// Принимает ключ `key` и значение `value`.\r\nconst save = (key, value) => {\r\n  try {\r\n    const serializedState = JSON.stringify(value);\r\n    localStorage.setItem(key, serializedState);\r\n  } catch (err) {\r\n    console.error('Set state error: ', err);\r\n  }\r\n};\r\n\r\nexport default {\r\n  load,\r\n  save\r\n};\r\n"],"sourceRoot":""}